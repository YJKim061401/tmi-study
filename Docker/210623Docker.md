* 참고자료

  * https://docs.docker.com/get-started/overview/
  * https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html

* 도커를 쓰게 된 배경

  * 서버환경이 계속 바뀌고, 버전을 업데이트 할 필요성도 생기고, 하나의 서버에 여러 개의 프로그램을 설치하는데 사용하는 라이브러리 버전이 다르거나 동일한 포트를 사용하는 경우가 있다.
  * 격리된 공간에서 프로세스를 동작하기 위해 Hypervisor를 이용한 OS를 가상화하는 VM(Virtual Machine)이 등장하였지만, 타입 1(Xen), 타입 2(VMware, VirtualBox) 모두 추가적인 OS를 설치해야해서 운영 환경에서는 너무 무거웠다.

  ![가상머신과 도커](./210623Docker.assets/vm-vs-docker.png)

* 도커란?

  * 다양한 실행환경을 컨테이너로 추상화하고 동일한 인터페이스를 제공하여 프로그램의 배포 및 관리를 단순하게 해주는 것

    ![Docker Layer](210623Docker.assets/architecture.svg)

* Container

  * 프로세스를 격리하여 실행
  * 컨테이너가 지워지면 그 상태가 저장되지 않는다(그러려면 image를 만들어야 함)

* Image

  * 컨테이너 실행에 필요한 파일과 설정값 등을 포함
  * Immutable
  * Docker hub에 등록하거나 Docker Registry 저장소를 직접 만들어 관리할 수 있다.

* 레이어 저장방식

  ![Docker Layer](./210623Docker.assets/image-layer.png)

  * 아이디어 : 파일 하나 추가했다고 기존 이미지를 모두 다시 다운 받는 건 비효율적
  * web app source만 수정하면 기존에 있던 A, B, C, nginx 레이어는 놔두고 web app source만 다시 받으면 된다.
  * container를 실행시키고 file을 쓰면, 그 파일은 image layers 위에 top-level read-write layer가 추가되어 쓰기가 실행된다.
  * 모든 layer들은 base에서 파일단위의 차이(diff) 정보를 가지고 있다.(git은 line단위의 차이정보)

* Dockerfile

  * image를 만들 수 있도록 생성 과정이 적혀있는 파일

    ```dockerfile
    # vertx/vertx3 debian version
    FROM subicura/vertx3:3.3.1
    MAINTAINER chungsub.kim@purpleworks.co.kr
    
    ADD build/distributions/app-3.3.1.tar /
    ADD config.template.json /app-3.3.1/bin/config.json
    ADD docker/script/start.sh /usr/local/bin/
    RUN ln -s /usr/local/bin/start.sh /start.sh
    
    EXPOSE 8080
    EXPOSE 7000
    
    CMD ["start.sh"]
    ```

    

